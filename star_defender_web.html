<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>星际捍卫者于闻言</title>
    <!-- 引入PyScript库 -->
    <link rel="stylesheet" href="https://pyscript.net/latest/pyscript.css" />
    <script defer src="https://pyscript.net/latest/pyscript.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #000;
            font-family: Arial, sans-serif;
        }
        #game-container {
            border: 2px solid #00ff00;
            border-radius: 10px;
            overflow: hidden;
        }
        h1 {
            color: #00ff00;
            text-align: center;
            margin-top: 20px;
        }
        .instructions {
            color: #ffffff;
            text-align: center;
            margin: 10px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <py-script>
            <!-- 这里将放置游戏代码 -->
            import pygame
            import sys
            import random
            
            # 初始化Pygame
            pygame.init()
            
            # 设置屏幕尺寸
            SCREEN_WIDTH = 400
            SCREEN_HEIGHT = 600
            
            # 游戏状态常量
            START_MENU = 0
            GAME_PLAYING = 1
            GAME_PAUSED = 2
            GAME_OVER = 3
            GAME_WON = 4
            
            # 颜色定义
            BLACK = (0, 0, 0)
            WHITE = (255, 255, 255)
            RED = (255, 0, 0)
            GREEN = (0, 255, 0)
            BLUE = (0, 0, 255)
            YELLOW = (255, 255, 0)
            CYAN = (0, 255, 255)
            MAGENTA = (255, 0, 255)
            
            # 游戏主类
            class StarDefender:
                def __init__(self):
                    self.screen = pygame.display.set_mode((SCREEN_WIDTH, SCREEN_HEIGHT))
                    pygame.display.set_caption("星际捍卫者于闻言")
                    self.clock = pygame.time.Clock()
                    self.fps = 60
                    
                    # 游戏状态
                    self.game_state = START_MENU
                    
                    # 游戏元素
                    self.background = Background()
                    
                    # 字体 - 使用系统自带的中文字体
                    try:
                        # 尝试使用微软雅黑字体
                        font_path = "C:/Windows/Fonts/msyh.ttc"
                        self.font_small = pygame.font.Font(font_path, 24)
                        self.font_medium = pygame.font.Font(font_path, 36)
                        self.font_large = pygame.font.Font(font_path, 48)
                    except Exception:
                        try:
                            # 尝试使用黑体字体
                            font_path = "C:/Windows/Fonts/simhei.ttf"
                            self.font_small = pygame.font.Font(font_path, 24)
                            self.font_medium = pygame.font.Font(font_path, 36)
                            self.font_large = pygame.font.Font(font_path, 48)
                        except Exception:
                            # 如果都失败，回退到默认字体
                            self.font_small = pygame.font.Font(None, 24)
                            self.font_medium = pygame.font.Font(None, 36)
                            self.font_large = pygame.font.Font(None, 48)
                    
                    # 游戏计时器
                    self.game_time = 0
                    
                    # 玩家
                    self.player = Player(self)
                    
                    # 子弹
                    self.bullets = []
                    
                    # 敌机
                    self.enemies = []
                    
                    # 敌机子弹
                    self.enemy_bullets = []
                    
                    # 粒子效果
                    self.particles = []
                    
                    # 道具
                    self.power_ups = []
                    
                    # 爆炸效果
                    self.explosions = []
                    
                    # 分数
                    self.score = 0
                    
                    # 关卡
                    self.level = 1
                    
                    # 炸弹数量
                    self.bombs = 3
                    
                    # 游戏统计
                    self.enemies_destroyed = 0
                    
                    # Boss相关
                    self.boss = None
                    self.boss_active = False
                    self.boss_health = 0
                    self.boss_max_health = 0
                    
                    # 无敌时间
                    self.invulnerable = False
                    self.invulnerable_time = 0
                    
                    # 暂停时的时间
                    self.paused_time = 0
                    # 游戏状态常量
                    self.START_MENU = 0
                    self.GAME_PLAYING = 1
                    self.GAME_PAUSED = 2
                    self.GAME_OVER = 3
                    self.GAME_WON = 4
                    
                    # 游戏状态
                    self.game_state = self.START_MENU
                    
                    # FPS设置
                    self.FPS = 60
                    self.clock = pygame.time.Clock()
                    
                    # 初始化游戏
                    self.reset_game()
                    
                def run(self):
                    """游戏主循环"""
                    while True:
                        self.handle_events()
                        
                        if self.game_state == self.GAME_PLAYING:
                            self.update()
                        
                        self.draw()
                        self.clock.tick(self.FPS)
                
                def handle_events(self):
                    """处理事件"""
                    for event in pygame.event.get():
                        if event.type == pygame.QUIT:
                            pygame.quit()
                            sys.exit()
                        
                        if event.type == pygame.KEYDOWN:
                            # 游戏菜单
                            if self.game_state == self.START_MENU:
                                if event.key == pygame.K_SPACE:
                                    self.start_game()
                            
                            # 游戏中
                            elif self.game_state == self.GAME_PLAYING:
                                if event.key == pygame.K_p or event.key == pygame.K_ESCAPE:
                                    self.pause_game()
                                elif event.key == pygame.K_b:
                                    self.use_bomb()
                            
                            # 暂停菜单
                            elif self.game_state == self.GAME_PAUSED:
                                if event.key == pygame.K_p or event.key == pygame.K_ESCAPE:
                                    self.resume_game()
                                elif event.key == pygame.K_r:
                                    self.restart_game()
                            
                            # 游戏结束或胜利
                            elif self.game_state in [self.GAME_OVER, self.GAME_WON]:
                                if event.key == pygame.K_r:
                                    self.restart_game()
                                elif event.key == pygame.K_q:
                                    pygame.quit()
                                    sys.exit()
                        
                        # 鼠标事件
                        elif event.type == pygame.MOUSEBUTTONDOWN:
                            if self.game_state == self.START_MENU:
                                self.start_game()
                
                def start_game(self):
                    """开始游戏"""
                    self.game_state = self.GAME_PLAYING
                    
                def pause_game(self):
                    """暂停游戏"""
                    self.game_state = self.GAME_PAUSED
                
                def resume_game(self):
                    """恢复游戏"""
                    self.game_state = self.GAME_PLAYING
                
                def restart_game(self):
                    """重新开始游戏"""
                    self.reset_game()
                    self.game_state = self.GAME_PLAYING
                
                def reset_game(self):
                    """重置游戏状态"""
                    self.score = 0
                    self.level = 1
                    self.player.reset()
                    
                    # 清空对象
                    self.bullets.clear()
                    self.enemies.clear()
                    self.enemy_bullets.clear()
                    self.particles.clear()
                    self.power_ups.clear()
                    self.explosions.clear()
                    
                    # 重置Boss
                    self.boss = None
                    self.boss_active = False
                    
                    # 游戏计时器
                    self.game_timer = pygame.time.get_ticks()
                    self.enemy_spawn_timer = 0
                    self.enemy_spawn_interval = 1000  # 初始1秒生成一个敌人
                
                def update(self):
                    """更新游戏状态"""
                    current_time = pygame.time.get_ticks()
                    
                    # 更新背景
                    self.background.update()
                    
                    # 更新玩家
                    self.player.update()
                    
                    # 检查玩家是否死亡
                    if self.player.lives <= 0:
                        self.game_over()
                        return
                    
                    # 更新子弹
                    for bullet in self.bullets[:]:
                        bullet.update()
                        if bullet.y < 0:
                            self.bullets.remove(bullet)
                    
                    # 更新敌机
                    for enemy in self.enemies[:]:
                        enemy.update(self)
                        if enemy.y > SCREEN_HEIGHT:
                            self.enemies.remove(enemy)
                    
                    # 更新敌机子弹
                    for bullet in self.enemy_bullets[:]:
                        bullet.update()
                        if bullet.y > SCREEN_HEIGHT:
                            self.enemy_bullets.remove(bullet)
                    
                    # 更新粒子效果
                    for particle in self.particles[:]:
                        particle.update()
                        if particle.life <= 0:
                            self.particles.remove(particle)
                    
                    # 更新爆炸效果
                    for explosion in self.explosions[:]:
                        explosion.update()
                        if explosion.life <= 0:
                            self.explosions.remove(explosion)
                    
                    # 更新道具
                    for power_up in self.power_ups[:]:
                        power_up.update()
                        if power_up.y > SCREEN_HEIGHT:
                            self.power_ups.remove(power_up)
                    
                    # 生成敌人
                    if current_time - self.enemy_spawn_timer > self.enemy_spawn_interval:
                        x = random.randint(50, SCREEN_WIDTH - 50)
                        enemy_type = random.choice([1, 2, 3])
                        enemy = Enemy(x, -50, enemy_type)
                        self.enemies.append(enemy)
                        self.enemy_spawn_timer = current_time
                    
                    # 检查碰撞
                    self.check_collisions()
                
                def draw(self):
                    """绘制游戏画面"""
                    self.background.draw(screen)
                    
                    # 绘制游戏元素
                    if self.game_state in [self.GAME_PLAYING, self.GAME_PAUSED]:
                        # 绘制玩家
                        self.player.draw(screen)
                        
                        # 绘制子弹
                        for bullet in self.bullets:
                            bullet.draw(screen)
                        
                        # 绘制敌人
                        for enemy in self.enemies:
                            enemy.draw(screen)
                        
                        # 绘制敌机子弹
                        for bullet in self.enemy_bullets:
                            bullet.draw(screen)
                        
                        # 绘制粒子效果
                        for particle in self.particles:
                            particle.draw(screen)
                        
                        # 绘制爆炸效果
                        for explosion in self.explosions:
                            explosion.draw(screen)
                        
                        # 绘制道具
                        for power_up in self.power_ups:
                            power_up.draw(screen)
                        
                        # 绘制Boss
                        if self.boss and self.boss_active:
                            self.boss.draw(screen)
                            self.draw_boss_health_bar()
                        
                        # 绘制UI
                        self.draw_ui()
                    
                    # 绘制菜单
                    if self.game_state == self.START_MENU:
                        self.draw_start_menu()
                    elif self.game_state == self.GAME_PAUSED:
                        self.draw_pause_menu()
                    elif self.game_state == self.GAME_OVER:
                        self.draw_game_over()
                    elif self.game_state == self.GAME_WON:
                        self.draw_game_won()
                    
                    pygame.display.flip()
                
                def start_game(self):
                    """开始游戏"""
                    self.game_state = self.GAME_PLAYING
                
                def pause_game(self):
                    """暂停游戏"""
                    self.game_state = self.GAME_PAUSED
                
                def resume_game(self):
                    """恢复游戏"""
                    self.game_state = self.GAME_PLAYING
                
                def restart_game(self):
                    """重新开始游戏"""
                    self.reset_game()
                    self.game_state = self.GAME_PLAYING
                
                def game_over(self):
                    """游戏结束"""
                    self.game_state = self.GAME_OVER
                
                def game_won(self):
                    """游戏胜利"""
                    self.game_state = self.GAME_WON
                
                def use_bomb(self):
                    """使用全屏轰炸"""
                    pass
                
                def create_explosion(self, x, y):
                    """创建爆炸效果"""
                    explosion = Explosion(x, y)
                    self.explosions.append(explosion)
                
                def check_collisions(self):
                    """检查碰撞"""
                    pass
                
                def draw_ui(self):
                    """绘制UI"""
                    pass
                
                def draw_boss_health_bar(self):
                    """绘制Boss血条"""
                    pass
                
                def draw_start_menu(self):
                    """绘制开始菜单"""
                    # 半透明背景
                    overlay = pygame.Surface((SCREEN_WIDTH, SCREEN_HEIGHT))
                    overlay.fill(BLACK)
                    overlay.set_alpha(180)
                    screen.blit(overlay, (0, 0))
                    
                    # 标题
                    title = self.font_large.render("星际捍卫者于闻言", True, WHITE)
                    title_rect = title.get_rect(center=(SCREEN_WIDTH // 2, SCREEN_HEIGHT // 2 - 100))
                    screen.blit(title, title_rect)
                    
                    # 副标题
                    subtitle = self.font_medium.render("Star Defender", True, CYAN)
                    subtitle_rect = subtitle.get_rect(center=(SCREEN_WIDTH // 2, SCREEN_HEIGHT // 2 - 50))
                    screen.blit(subtitle, subtitle_rect)
                    
                    # 提示
                    hint = self.font_small.render("按空格键或鼠标左键开始游戏", True, WHITE)
                    hint_rect = hint.get_rect(center=(SCREEN_WIDTH // 2, SCREEN_HEIGHT // 2 + 50))
                    screen.blit(hint, hint_rect)
                    
                    # 操作说明
                    controls = [
                        "操作说明:",
                        "- 鼠标拖动: 移动战机",
                        "- 游戏开始1秒后自动射击",
                        "- B键或点击炸弹图标: 使用全屏轰炸",
                        "- P键: 暂停游戏"
                    ]
                    
                    for i, line in enumerate(controls):
                        text = self.font_small.render(line, True, WHITE)
                        text_rect = text.get_rect(center=(SCREEN_WIDTH // 2, SCREEN_HEIGHT // 2 + 100 + i * 25))
                        screen.blit(text, text_rect)
                
                def draw_pause_menu(self):
                    """绘制暂停菜单"""
                    # 半透明背景
                    overlay = pygame.Surface((SCREEN_WIDTH, SCREEN_HEIGHT))
                    overlay.fill(BLACK)
                    overlay.set_alpha(180)
                    screen.blit(overlay, (0, 0))
                    
                    # 标题
                    title = self.font_large.render("游戏暂停", True, WHITE)
                    title_rect = title.get_rect(center=(SCREEN_WIDTH // 2, SCREEN_HEIGHT // 2 - 50))
                    screen.blit(title, title_rect)
                    
                    # 提示
                    hint1 = self.font_medium.render("按P键或ESC键继续", True, WHITE)
                    hint1_rect = hint1.get_rect(center=(SCREEN_WIDTH // 2, SCREEN_HEIGHT // 2 + 20))
                    screen.blit(hint1, hint1_rect)
                    
                    hint2 = self.font_medium.render("按R键重新开始", True, WHITE)
                    hint2_rect = hint2.get_rect(center=(SCREEN_WIDTH // 2, SCREEN_HEIGHT // 2 + 60))
                    screen.blit(hint2, hint2_rect)
                
                def draw_game_over(self):
                    """绘制游戏结束界面"""
                    # 半透明背景
                    overlay = pygame.Surface((SCREEN_WIDTH, SCREEN_HEIGHT))
                    overlay.fill(BLACK)
                    overlay.set_alpha(180)
                    screen.blit(overlay, (0, 0))
                    
                    # 标题
                    title = self.font_large.render("游戏结束", True, RED)
                    title_rect = title.get_rect(center=(SCREEN_WIDTH // 2, SCREEN_HEIGHT // 2 - 50))
                    screen.blit(title, title_rect)
                    
                    # 分数
                    score_text = self.font_medium.render(f"最终分数: {self.score}", True, WHITE)
                    score_rect = score_text.get_rect(center=(SCREEN_WIDTH // 2, SCREEN_HEIGHT // 2 + 20))
                    screen.blit(score_text, score_rect)
                    
                    # 提示
                    hint1 = self.font_medium.render("按R键重新开始", True, WHITE)
                    hint1_rect = hint1.get_rect(center=(SCREEN_WIDTH // 2, SCREEN_HEIGHT // 2 + 70))
                    screen.blit(hint1, hint1_rect)
                    
                    hint2 = self.font_medium.render("按Q键退出", True, WHITE)
                    hint2_rect = hint2.get_rect(center=(SCREEN_WIDTH // 2, SCREEN_HEIGHT // 2 + 110))
                    screen.blit(hint2, hint2_rect)
                
                def draw_game_won(self):
                    """绘制游戏胜利界面"""
                    # 半透明背景
                    overlay = pygame.Surface((SCREEN_WIDTH, SCREEN_HEIGHT))
                    overlay.fill(BLACK)
                    overlay.set_alpha(180)
                    screen.blit(overlay, (0, 0))
                    
                    # 标题
                    title = self.font_large.render("游戏胜利", True, GREEN)
                    title_rect = title.get_rect(center=(SCREEN_WIDTH // 2, SCREEN_HEIGHT // 2 - 50))
                    screen.blit(title, title_rect)
                    
                    # 分数
                    score_text = self.font_medium.render(f"最终分数: {self.score}", True, WHITE)
                    score_rect = score_text.get_rect(center=(SCREEN_WIDTH // 2, SCREEN_HEIGHT // 2 + 20))
                    screen.blit(score_text, score_rect)
                    
                    # 提示
                    hint1 = self.font_medium.render("按R键重新开始", True, WHITE)
                    hint1_rect = hint1.get_rect(center=(SCREEN_WIDTH // 2, SCREEN_HEIGHT // 2 + 70))
                    screen.blit(hint1, hint1_rect)
                    
                    hint2 = self.font_medium.render("按Q键退出", True, WHITE)
                    hint2_rect = hint2.get_rect(center=(SCREEN_WIDTH // 2, SCREEN_HEIGHT // 2 + 110))
                    screen.blit(hint2, hint2_rect)
            
            # 背景类
            class Background:
                def __init__(self):
                    self.stars = []
                    for _ in range(100):
                        x = random.randint(0, SCREEN_WIDTH)
                        y = random.randint(0, SCREEN_HEIGHT)
                        speed = random.uniform(0.5, 2.0)
                        size = random.randint(1, 3)
                        color = (random.randint(100, 255), random.randint(100, 255), random.randint(100, 255))
                        self.stars.append((x, y, speed, size, color))
                
                def update(self):
                    for i in range(len(self.stars)):
                        x, y, speed, size, color = self.stars[i]
                        y += speed
                        if y > SCREEN_HEIGHT:
                            y = 0
                            x = random.randint(0, SCREEN_WIDTH)
                        self.stars[i] = (x, y, speed, size, color)
                
                def draw(self, screen):
                    screen.fill(BLACK)
                    for star in self.stars:
                        x, y, speed, size, color = star
                        pygame.draw.circle(screen, color, (int(x), int(y)), size)
            
            # 玩家类
            class Player:
                def __init__(self, game):
                    self.game = game  # 引用游戏实例
                    self.width = 40
                    self.height = 60
                    self.x = SCREEN_WIDTH // 2 - self.width // 2
                    self.y = SCREEN_HEIGHT - 100
                    self.speed = 8
                    self.lives = 3
                    self.invulnerable = False
                    self.invulnerable_time = 0
                    self.invulnerable_duration = 1000  # 1秒无敌时间
                    
                    # 子弹相关
                    self.shoot_timer = 0
                    self.shoot_interval = 200  # 200毫秒发射一次
                    
                    # 碰撞矩形
                    self.rect = pygame.Rect(self.x, self.y, self.width, self.height)
                    
                    # 鼠标控制
                    self.mouse_down = False
                    self.target_x = self.x
                    
                    # 自动射击相关
                    self.game_start_time = 0
                    self.auto_shoot_enabled = False
                
                def reset(self):
                    """重置玩家状态"""
                    self.x = SCREEN_WIDTH // 2 - self.width // 2
                    self.y = SCREEN_HEIGHT - 100
                    self.lives = 3
                    self.invulnerable = False
                    self.invulnerable_time = 0
                    self.shoot_timer = 0
                    self.target_x = self.x
                    self.rect.topleft = (self.x, self.y)
                    self.game_start_time = pygame.time.get_ticks()
                    self.auto_shoot_enabled = False
                
                def update(self):
                    """更新玩家状态"""
                    current_time = pygame.time.get_ticks()
                    
                    # 鼠标控制
                    self.handle_mouse_control()
                    
                    # 移动
                    if abs(self.target_x - self.x) > 5:
                        if self.target_x > self.x:
                            self.x += self.speed
                        else:
                            self.x -= self.speed
                    
                    # 边界检查
                    self.x = max(0, min(SCREEN_WIDTH - self.width, self.x))
                    
                    # 更新碰撞矩形
                    self.rect.topleft = (self.x, self.y)
                    
                    # 自动射击控制
                    if not self.auto_shoot_enabled:
                        if current_time - self.game_start_time > 1000:  # 1秒后启用自动射击
                            self.auto_shoot_enabled = True
                    
                    # 自动射击
                    if self.mouse_down or self.auto_shoot_enabled:
                        self.shoot()
                    
                    # 更新无敌状态
                    if self.invulnerable:
                        if current_time - self.invulnerable_time > self.invulnerable_duration:
                            self.invulnerable = False
                
                def handle_mouse_control(self):
                    """处理鼠标控制"""
                    mouse_buttons = pygame.mouse.get_pressed()
                    self.mouse_down = mouse_buttons[0]
                    
                    if self.mouse_down:
                        mouse_x, mouse_y = pygame.mouse.get_pos()
                        self.target_x = mouse_x - self.width // 2
                
                def shoot(self):
                    """射击"""
                    current_time = pygame.time.get_ticks()
                    if current_time - self.shoot_timer > self.shoot_interval:
                        bullet = Bullet(self.x + self.width // 2 - 2, self.y, 4, -10)
                        self.game.bullets.append(bullet)
                        self.shoot_timer = current_time
                
                def take_damage(self):
                    """玩家受伤"""
                    if not self.invulnerable:
                        self.lives -= 1
                        self.invulnerable = True
                        self.invulnerable_time = pygame.time.get_ticks()
                        return True
                    return False
                
                def draw(self, screen):
                    """绘制玩家"""
                    # 绘制玩家战机
                    pygame.draw.polygon(screen, WHITE, [
                        (self.x + self.width // 2, self.y),
                        (self.x, self.y + self.height),
                        (self.x + self.width, self.y + self.height)
                    ])
                    
                    # 绘制机翼
                    pygame.draw.polygon(screen, CYAN, [
                        (self.x + self.width // 4, self.y + self.height // 2),
                        (self.x - self.width // 4, self.y + self.height // 4),
                        (self.x + self.width // 4, self.y + self.height // 3)
                    ])
                    
                    pygame.draw.polygon(screen, CYAN, [
                        (self.x + 3 * self.width // 4, self.y + self.height // 2),
                        (self.x + 5 * self.width // 4, self.y + self.height // 4),
                        (self.x + 3 * self.width // 4, self.y + self.height // 3)
                    ])
                    
                    # 绘制引擎
                    pygame.draw.rect(screen, YELLOW, (
                        self.x + self.width // 4, 
                        self.y + self.height - 10, 
                        self.width // 2, 
                        10
                    ))
            
            # 子弹类
            class Bullet:
                def __init__(self, x, y, width, speed):
                    self.x = x
                    self.y = y
                    self.width = width
                    self.height = 10
                    self.speed = speed
                    self.rect = pygame.Rect(x, y, width, self.height)
                
                def update(self):
                    """更新子弹位置"""
                    self.y += self.speed
                    self.rect.y = self.y
                
                def draw(self, screen):
                    """绘制子弹"""
                    pygame.draw.rect(screen, YELLOW, self.rect)
            
            # 敌机类
            class Enemy:
                def __init__(self, x, y, type=1):
                    self.x = x
                    self.y = y
                    self.type = type
                    
                    if type == 1:
                        self.width = 30
                        self.height = 30
                        self.speed = 2
                        self.health = 1
                        self.color = RED
                        self.points = 10
                    elif type == 2:
                        self.width = 40
                        self.height = 40
                        self.speed = 1
                        self.health = 3
                        self.color = MAGENTA
                        self.points = 30
                    else:
                        self.width = 50
                        self.height = 50
                        self.speed = 0.5
                        self.health = 5
                        self.color = ORANGE
                        self.points = 50
                    
                    self.rect = pygame.Rect(x, y, self.width, self.height)
                    self.shoot_timer = 0
                    self.shoot_interval = random.randint(1000, 3000)
                
                def update(self, game):
                    """更新敌机状态"""
                    self.y += self.speed
                    self.rect.topleft = (self.x, self.y)
                    
                    # 射击
                    current_time = pygame.time.get_ticks()
                    if current_time - self.shoot_timer > self.shoot_interval:
                        self.shoot(game)
                        self.shoot_timer = current_time
                
                def shoot(self, game):
                    """敌机射击"""
                    bullet = Bullet(self.x + self.width // 2 - 2, self.y + self.height, 4, 5)
                    game.enemy_bullets.append(bullet)
                
                def take_damage(self, damage=1):
                    """敌机受伤"""
                    self.health -= damage
                    return self.health <= 0
                
                def draw(self, screen):
                    """绘制敌机"""
                    pygame.draw.rect(screen, self.color, self.rect)
                    
                    # 绘制敌机细节
                    if self.type == 2:
                        pygame.draw.circle(screen, YELLOW, 
                                          (self.x + self.width // 2, self.y + self.height // 2), 
                                          5)
                    elif self.type == 3:
                        pygame.draw.polygon(screen, YELLOW, [
                            (self.x + self.width // 2, self.y),
                            (self.x, self.y + self.height // 2),
                            (self.x + self.width, self.y + self.height // 2)
                        ])
            
            # 子弹类
            class Bullet:
                def __init__(self, x, y, width, speed):
                    self.x = x
                    self.y = y
                    self.width = width
                    self.height = 10
                    self.speed = speed
                    self.rect = pygame.Rect(x, y, width, self.height)
                
                def update(self):
                    """更新子弹位置"""
                    self.y += self.speed
                    self.rect.topleft = (self.x, self.y)
                
                def draw(self, screen):
                    """绘制子弹"""
                    pygame.draw.rect(screen, YELLOW, self.rect)
            
            # 粒子类
            class Particle:
                def __init__(self, x, y, color, size, speed_x, speed_y, lifetime=1000):
                    self.x = x
                    self.y = y
                    self.color = color
                    self.size = size
                    self.speed_x = speed_x
                    self.speed_y = speed_y
                    self.lifetime = lifetime
                    self.birth_time = pygame.time.get_ticks()
                
                def update(self):
                    """更新粒子状态"""
                    self.x += self.speed_x
                    self.y += self.speed_y
                    self.size *= 0.95
                
                def is_alive(self):
                    """检查粒子是否存活"""
                    return pygame.time.get_ticks() - self.birth_time < self.lifetime
                
                def draw(self, screen):
                    """绘制粒子"""
                    pygame.draw.circle(screen, self.color, (int(self.x), int(self.y)), int(self.size))
            
            # 爆炸类
            class Explosion:
                def __init__(self, x, y, size=50):
                    self.x = x
                    self.y = y
                    self.size = size
                    self.max_size = size
                    self.lifetime = 500
                    self.birth_time = pygame.time.get_ticks()
                
                def update(self):
                    """更新爆炸状态"""
                    self.size -= 0.5
                
                def is_alive(self):
                    """检查爆炸是否存活"""
                    return pygame.time.get_ticks() - self.birth_time < self.lifetime
                
                def draw(self, screen):
                    """绘制爆炸"""
                    alpha = int(255 * (1 - (pygame.time.get_ticks() - self.birth_time) / self.lifetime))
                    color = (255, 255, 0, alpha)
                    pygame.draw.circle(screen, color, (int(self.x), int(self.y)), int(self.size))
            
            # 道具类
            class PowerUp:
                def __init__(self, x, y, type=1):
                    self.x = x
                    self.y = y
                    self.type = type
                    self.width = 20
                    self.height = 20
                    self.speed = 3
                    self.rect = pygame.Rect(x, y, self.width, self.height)
                    
                    if type == 1:
                        self.color = GREEN
                        self.name = "bomb"
                    elif type == 2:
                        self.color = BLUE
                        self.name = "power"
                    else:
                        self.color = YELLOW
                        self.name = "life"
                
                def update(self):
                    """更新道具状态"""
                    self.y += self.speed
                    self.rect.topleft = (self.x, self.y)
                
                def draw(self, screen):
                    """绘制道具"""
                    pygame.draw.rect(screen, self.color, self.rect)
            
            # 主游戏循环
            if __name__ == "__main__":
                game = StarDefender()
                game.run()
        </py-script>
    </div>
    <div class="instructions">
        <h1>星际捍卫者于闻言</h1>
        <p>操作说明：</p>
        <p>• 按空格键或鼠标左键开始游戏</p>
        <p>• 鼠标拖动控制战机移动</p>
        <p>• 游戏开始1秒后自动射击</p>
        <p>• B键或点击炸弹图标使用炸弹</p>
        <p>• P/ESC键暂停游戏</p>
    </div>
</body>
</html>